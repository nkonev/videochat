(this["webpackJsonplivekit-egress-web"]=this["webpackJsonplivekit-egress-web"]||[]).push([[0],{12:function(t,e,a){t.exports={stage:"SpeakerLayout_stage__25205",stageCenter:"SpeakerLayout_stageCenter__2UqBp",stageSidebar:"SpeakerLayout_stageSidebar__WeIBE"}},31:function(t,e,a){},52:function(t,e,a){},53:function(t,e,a){"use strict";a.r(e);var i=a(14),n=a.n(i),r=a(9),c=a.n(r),s=(a(29),a(1)),o=a.n(s),d=(a(30),a(31),a(6)),u=a(7),l=a(2),p=a(3),g=a(8),h=a.n(g),f=a(4),j=function(t){var e=t.participants,a=t.room,i=o.a.useState([]),n=Object(d.a)(i,2),r=n[0],c=n[1],l=o.a.useState(h.a.grid1x1),g=Object(d.a)(l,2),j=g[0],b=g[1];return Object(s.useEffect)((function(){var t,i=e.length;1===e.length?b(h.a.grid1x1):2===e.length?b(h.a.grid2x1):e.length<=4?b(h.a.grid2x2):e.length<=9?b(h.a.grid3x3):e.length<=16?b(h.a.grid4x4):(b(h.a.grid5x5),i=Math.min(i,25));var n=[];r.forEach((function(t){((null===a||void 0===a?void 0:a.participants.has(t.sid))||(null===a||void 0===a?void 0:a.localParticipant.sid)===t.sid)&&n.push(t)})),null===a||void 0===a||null===(t=a.activeSpeakers)||void 0===t||t.forEach((function(t){if(!n.includes(t)&&(t===(null===a||void 0===a?void 0:a.localParticipant)||(null===a||void 0===a?void 0:a.participants.has(t.sid)))){var e=n.findIndex((function(t){return!t.isSpeaking}));e>=0?n[e]=t:n.push(t)}}));var s,o=Object(p.a)(e);try{for(o.s();!(s=o.n()).done;){var d=s.value;if(n.length>=i)break;n.includes(d)||d.isSpeaking||n.push(d)}}catch(u){o.e(u)}finally{o.f()}n.length>i&&n.splice(i,n.length-i),c(n)}),[e]),0===r.length?Object(f.jsx)("div",{}):Object(f.jsx)("div",{className:"".concat(h.a.stage," ").concat(j),children:r.map((function(t){return Object(f.jsx)(u.b,{participant:t,orientation:"landscape",width:"100%",height:"100%",speakerClassName:""},t.identity)}))})};function b(t){var e=Object(s.useState)(),a=Object(d.a)(e,2),i=a[0],n=a[1];return Object(s.useEffect)((function(){if(i){if(i.isSpeaking)return;if(i.lastSpokeAt&&Date.now()-i.lastSpokeAt.getTime()<3e3)return}var e,a=i,r=Object(p.a)(t);try{for(r.s();!(e=r.n()).done;){var c=e.value;c.isSpeaking&&(void 0===a||c.audioLevel>a.audioLevel)&&(a=c)}}catch(s){r.e(s)}finally{r.f()}a!==i&&n(a)}),[t]),i}var v=function(t){var e,a=t.participants,i=b(a);if(a.forEach((function(t){var a=t.getTrack(l.Track.Source.ScreenShare);a&&a.isSubscribed&&(e=a.videoTrack)})),0===a.length)return Object(f.jsx)("div",{});if(e)return Object(f.jsx)(u.c,{track:e,height:"100%",width:"100%"});var n=null!==i&&void 0!==i?i:a[0];return Object(f.jsx)(u.b,{participant:n,width:"100%",height:"100%",orientation:"landscape",speakerClassName:""},n.identity)},x=a(12),k=a.n(x),O=function(t){var e,a,i,n=t.participants,r=b(n);if(n.forEach((function(t){var a=t.getTrack(l.Track.Source.ScreenShare);a&&a.isSubscribed&&(e=a.videoTrack)})),0===n.length)return Object(f.jsx)("div",{});if(1===n.length&&!e)return Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(u.b,{participant:n[0],width:"100%",height:"100%",orientation:"landscape",speakerClassName:""})});if(e)a=n,i=Object(f.jsx)(u.c,{track:e,height:"100%",width:"100%"});else{var c=null!==r&&void 0!==r?r:n[0];a=n.filter((function(t){return t!==c})),i=Object(f.jsx)(u.b,{participant:c,width:"100%",height:"100%",orientation:"landscape",speakerClassName:""},c.identity)}return Object(f.jsxs)("div",{className:k.a.stage,children:[Object(f.jsx)("div",{className:k.a.stageCenter,children:i}),Object(f.jsx)("div",{className:k.a.stageSidebar,children:a.map((function(t){return Object(f.jsx)(u.b,{participant:t,width:"100%",height:"100%",aspectWidth:16,aspectHeight:9,orientation:"landscape",speakerClassName:""},t.identity)}))})]})};function m(t){var e=t.url,a=t.token,i=t.layout,n=Object(s.useState)(i),r=Object(d.a)(n,2),o=r[0],p=r[1],g=Object(u.d)({adaptiveStream:!0}),h=g.room,j=g.participants,b=g.audioTracks;if(Object(s.useEffect)((function(){g.connect(e,a)}),[e]),Object(s.useEffect)((function(){h&&(c.a.setRoom(h,{autoEnd:!0}),c.a.onLayoutChanged((function(t){p(t)})),c.a.startRecording())}),[h]),!e||!a)return Object(f.jsx)("div",{className:"error",children:"missing required params url and token"});if(!h)return Object(f.jsx)("div",{});var v=j.filter((function(t){return t instanceof l.RemoteParticipant}));return Object(f.jsx)(_,{layout:o,room:h,participants:v,audioTracks:b})}function _(t){var e=t.layout,a=t.room,i=t.participants,n=t.audioTracks,r=Object(s.useState)(!1),c=Object(d.a)(r,2),o=c[0],p=c[1],g=Object(s.useCallback)((function(){var t=!1;a.participants.forEach((function(e){e.isScreenShareEnabled&&(t=!0)})),p(t)}),[a]);Object(s.useEffect)((function(){if(a)return a.on(l.RoomEvent.TrackPublished,g),a.on(l.RoomEvent.TrackUnpublished,g),a.on(l.RoomEvent.ConnectionStateChanged,g),function(){a.off(l.RoomEvent.TrackPublished,g),a.off(l.RoomEvent.TrackUnpublished,g),a.off(l.RoomEvent.ConnectionStateChanged,g)}}),[a]);var h="dark";e.endsWith("-light")&&(h="light");var b="roomContainer";h&&(b+=" ".concat(h));var x=Object(f.jsx)(f.Fragment,{});return o&&e.startsWith("grid")&&(e=e.replace("grid","speaker")),e.startsWith("speaker")?x=Object(f.jsx)(O,{room:a,participants:i}):e.startsWith("single-speaker")?x=Object(f.jsx)(v,{room:a,participants:i}):e.startsWith("grid")&&(x=Object(f.jsx)(j,{room:a,participants:i})),Object(f.jsxs)("div",{className:b,children:[x,n.map((function(t){return Object(f.jsx)(u.a,{track:t,isLocal:!1},t.sid)}))]})}var S=function(){return Object(f.jsx)("div",{className:"container",children:Object(f.jsx)(m,{url:c.a.getLiveKitURL(),token:c.a.getAccessToken(),layout:c.a.getLayout()})})};a(52);n.a.render(Object(f.jsx)(S,{}),document.getElementById("root"))},8:function(t,e,a){t.exports={stage:"GridLayout_stage__30DlR",grid1x1:"GridLayout_grid1x1__3aEAn",grid2x1:"GridLayout_grid2x1__2Ba_1",grid2x2:"GridLayout_grid2x2__2f_nY",grid3x3:"GridLayout_grid3x3__170FX",grid4x4:"GridLayout_grid4x4__2G9kX",grid5x5:"GridLayout_grid5x5__Iw6qK"}}},[[53,1,2]]]);
//# sourceMappingURL=main.47559a9a.chunk.js.map